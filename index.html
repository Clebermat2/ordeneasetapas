<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordene as Etapas: Prestação de Contas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            touch-action: none;
            cursor: grab;
            user-select: none;
            transition: all 0.2s ease-in-out;
        }
        .card:active {
            cursor: grabbing;
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .drop-zone {
            border: 2px dashed #cbd5e1;
            transition: background-color 0.2s ease;
        }
        .drag-over {
            background-color: #e2e8f0;
            border-color: #4f46e5;
        }
        .placeholder {
            height: 50px;
            background-color: #f1f5f9;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex items-center justify-center min-h-screen p-4">

    <main class="bg-white rounded-xl shadow-lg p-6 md:p-8 w-full max-w-4xl mx-auto">
        
        <!-- Tela de Início -->
        <div id="start-screen" class="text-center">
            <h1 class="text-3xl font-bold text-indigo-600">Atividade: Ordene as Etapas</h1>
            <p class="text-slate-600 mt-4 max-w-2xl mx-auto">Seja bem-vindo! Sua missão é ordenar as fases do processo de prestação de contas na sequência correta. Arraste e solte as cartas para montar o fluxo.</p>
            <div class="mt-8">
                <button id="start-button" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    Começar
                </button>
            </div>
        </div>

        <!-- Tela do Jogo (inicialmente oculta) -->
        <div id="game-screen" class="hidden">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-indigo-600">Atividade: Ordene as Etapas</h1>
                <p class="text-slate-600 mt-2">Arraste as cartas e ordene o fluxo. As cartas corretas ficarão verdes!</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- Coluna de etapas a ordenar -->
                <div>
                    <h2 class="text-lg font-semibold mb-4 text-center border-b pb-2">Etapas a Ordenar</h2>
                    <div id="unsorted-container" class="drop-zone space-y-3 min-h-[300px] p-2 rounded-lg">
                        <!-- As cartas serão inseridas aqui pelo JavaScript -->
                    </div>
                </div>

                <!-- Coluna para soltar as etapas ordenadas -->
                <div>
                    <h2 class="text-lg font-semibold mb-4 text-center border-b pb-2">Fluxo da Prestação de Contas</h2>
                    <div id="sorted-container" class="drop-zone space-y-3 min-h-[300px] p-4 rounded-lg">
                        <!-- Espaço para soltar as cartas -->
                    </div>
                </div>
            </div>

            <!-- Botão de Reiniciar -->
            <div class="text-center mt-8">
                <button id="restart-button" class="bg-slate-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-slate-600 transition-colors focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2">
                    Reiniciar
                </button>
            </div>
        </div>
        
        <!-- Tela Final (inicialmente oculta) -->
        <div id="end-screen" class="hidden text-center">
            <h1 class="text-3xl font-bold text-green-600">Parabéns!</h1>
            <p class="text-slate-600 mt-4 max-w-2xl mx-auto">Você completou a atividade com sucesso e ordenou corretamente o fluxo da prestação de contas.</p>
            <div class="mt-8">
                <button id="play-again-button" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    Jogar Novamente
                </button>
            </div>
        </div>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const steps = [
                { id: 1, text: 'UEx anexa os documentos fiscais no BB Gestão Ágil.' },
                { id: 2, text: 'UEx entrega a pasta física com todos os documentos para a EEx.' },
                { id: 3, text: 'EEx analisa a pasta física e confere os lançamentos no BB Gestão Ágil.' },
                { id: 4, text: 'EEx preenche o Demonstrativo Consolidado no SIGPC.' },
                { id: 5, text: 'EEx envia o Demonstrativo Consolidado ao FNDE.' }
            ];

            const startScreen = document.getElementById('start-screen');
            const gameScreen = document.getElementById('game-screen');
            const endScreen = document.getElementById('end-screen');
            
            const startButton = document.getElementById('start-button');
            const playAgainButton = document.getElementById('play-again-button');
            const restartButton = document.getElementById('restart-button');

            const unsortedContainer = document.getElementById('unsorted-container');
            const sortedContainer = document.getElementById('sorted-container');

            let draggedItem = null;
            
            startButton.addEventListener('click', () => {
                startScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');
                initializeGame();
            });

            playAgainButton.addEventListener('click', () => {
                endScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');
                initializeGame();
            });
            
            restartButton.addEventListener('click', initializeGame);

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function initializeGame() {
                unsortedContainer.innerHTML = '';
                sortedContainer.innerHTML = '';
                endScreen.classList.add('hidden');
                startScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');

                const shuffledSteps = [...steps];
                shuffleArray(shuffledSteps);

                shuffledSteps.forEach(step => {
                    const card = document.createElement('div');
                    card.className = 'card bg-white p-4 rounded-lg shadow border-l-4 border-slate-300';
                    card.draggable = true;
                    card.dataset.id = step.id;
                    card.textContent = step.text;
                    unsortedContainer.appendChild(card);
                });

                addDragListeners();
            }

            function addDragListeners() {
                const cards = document.querySelectorAll('.card');
                cards.forEach(card => {
                    card.addEventListener('dragstart', handleDragStart);
                    card.addEventListener('dragend', handleDragEnd);
                });
            }

            function handleDragStart(e) {
                draggedItem = e.target;
                setTimeout(() => {
                    e.target.style.opacity = '0.5';
                }, 0);
            }

            function handleDragEnd() {
                if(draggedItem) {
                    draggedItem.style.opacity = '1';
                }
                draggedItem = null;
                document.querySelectorAll('.placeholder').forEach(p => p.remove());
            }
            
            [unsortedContainer, sortedContainer].forEach(container => {
                container.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    container.classList.add('drag-over');
                    const afterElement = getDragAfterElement(container, e.clientY);
                    const placeholder = document.querySelector('.placeholder');
                    if (!placeholder) {
                        const newPlaceholder = document.createElement('div');
                        newPlaceholder.className = 'placeholder';
                         if (afterElement == null) {
                            container.appendChild(newPlaceholder);
                        } else {
                            container.insertBefore(newPlaceholder, afterElement);
                        }
                    }
                });
                
                container.addEventListener('dragleave', () => {
                    container.classList.remove('drag-over');
                    document.querySelectorAll('.placeholder').forEach(p => p.remove());
                });

                container.addEventListener('drop', (e) => {
                    e.preventDefault();
                    container.classList.remove('drag-over');
                    const placeholder = document.querySelector('.placeholder');
                    
                    if (draggedItem) {
                         if (placeholder) {
                            container.insertBefore(draggedItem, placeholder);
                        } else {
                            container.appendChild(draggedItem);
                        }
                        if (placeholder) placeholder.remove();

                        updateAndCheckOrder();
                    }
                });
            });


            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.card:not(.dragging)')];
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            function updateAndCheckOrder() {
                // Reset borders of cards in the unsorted pile
                unsortedContainer.querySelectorAll('.card').forEach(card => {
                    card.classList.remove('border-green-500');
                    card.classList.add('border-slate-300');
                });

                const sortedCards = sortedContainer.querySelectorAll('.card');
                let correctCount = 0;

                sortedCards.forEach((card, index) => {
                    const isCorrect = parseInt(card.dataset.id) === index + 1;
                    card.classList.remove('border-slate-300', 'border-green-500');

                    if (isCorrect) {
                        card.classList.add('border-green-500');
                        correctCount++;
                    } else {
                        card.classList.add('border-slate-300');
                    }
                });

                if (correctCount === steps.length && sortedCards.length === steps.length) {
                    setTimeout(() => {
                        gameScreen.classList.add('hidden');
                        endScreen.classList.remove('hidden');
                    }, 500); 
                }
            }
        });
    </script>
</body>
</html>

